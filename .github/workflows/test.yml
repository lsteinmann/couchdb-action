name: Test
on:
  push:
    branches:
    - master

jobs:
  tests:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
    - name: Set up CouchDB
      uses: ./
    - name: Test that CouchDB can be accessed
      run: curl -sS -f http://127.0.0.1:3001/
    - name: See if that worked
      run: | 
        curl -X GET http://127.0.0.1:3001/_all_dbs
        curl -X GET http://127.0.0.1:3001/rtest/_all_docs
        curl -X POST -H 'Content-Type: application/json' -d '{"selector": {"resource.identifier": "Surveyareal 1"}, "limit": 1}' http://127.0.0.1:3001/rtest/_find